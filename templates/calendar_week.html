{% extends "base.html" %}
{% block content %}
{% load budget_extras %}

<div class="flex items-center justify-between mb-4">
    <div>
      <h1 class="text-2xl font-bold">Week of {{ week_start }} - {{ week_end }}

        <div class="mt-2 flex gap-3 text-xs">
          <span class="px-2 py-1 rounded bg-blue-200/90">Mike</span>
          <span class="px-2 py-1 rounded bg-pink-200/90">Stef</span>
          <span class="px-2 py-1 rounded bg-green-200/90">Max</span>
          <span class="px-2 py-1 rounded bg-purple-200/90">Leo</span>
        </div>
      </h1>
    
      <div class="mt-1 flex gap-3 text-sm">
        <a class="px-3 py-1 rounded bg-gray-200/80 flex items-center" 
        href="{% url 'calendar_month' %}?y={{ week_start|date:'Y' }}&m={{ week_start|date:'n' }}{% if kiosk_qs %}&{{ kiosk_qs }}{% endif %}"
        aria-label="Month">
          <span class="material-symbols-outlined">calendar_month</span>
          <!-- Optional: Add text label next to icon, like "Month" -->
        </a>  
        <a class="px-3 py-1 rounded bg-gray-200/80 flex items-center"
           href="{% url 'calendar_week' %}?date={{ week_start|date:'Y-m-d' }}{% if kiosk_qs %}&{{ kiosk_qs }}{% endif %}"
           aria-label="Week">
          <span class="material-symbols-outlined">calendar_view_week</span>
          <!-- Optional: Add text label next to icon, like "Week" -->
        </a>
        <a class="px-3 py-1 rounded bg-gray-200/80 flex items-center"
           href="{% url 'calendar_day' %}?date={{ today|date:'Y-m-d' }}{% if kiosk_qs %}&{{ kiosk_qs }}{% endif %}"
           aria-label="Day">
          <span class="material-symbols-outlined">calendar_view_day</span>
          <!-- Optional: Add text label next to icon, like "Day" -->
        </a>
      </div>
    </div>

    <div class="flex gap-2">
      <a class="px-3 py-1 rounded bg-gray-200/80 flex items-center"
         href="{% url 'calendar_week' %}?date={{ prev_week|date:'Y-m-d' }}{% if kiosk_qs %}&{{ kiosk_qs }}{% endif %}"
         aria-label="Previous Week">
          <span class="material-symbols-outlined">chevron_left</span>
          <!-- Optional: Add text label next to icon, like "Prev" or "Previous Month" -->
    </a>
      <a class="px-3 py-1 rounded bg-gray-200/80 flex items-center"
         href="{% url 'calendar_week' %}?date={{ today|date:'Y-m-d' }}{% if kiosk_qs %}&{{ kiosk_qs }}{% endif %}"
         aria-label="Current Week">
          <span class="material-symbols-outlined">today</span>
          <!-- Optional: Add text label next to icon, like "Current" or "Current Week" -->
    </a>
      <a class="px-3 py-1 rounded bg-gray-200/80 flex items-center"
         href="{% url 'calendar_week' %}?date={{ next_week|date:'Y-m-d' }}{% if kiosk_qs %}&{{ kiosk_qs }}{% endif %}"
         aria-label="Next Week">
        <span class="material-symbols-outlined">chevron_right</span>
        <!-- Optional: Add text label next to icon, like "Next" or "Next Month" -->
    </a>
    </div>
  </div>

  <!-- Calendar Home button -->
  <div class="flex justify-end mt-4">
    <a class="px-3 py-1 rounded bg-blue-200/80"
      href="{% url 'calendar_home' %}{% if kiosk_qs %}?{{ kiosk_qs }}{% endif %}"
      aria-label="Home">
        <span class="material-symbols-outlined">home</span>
    </a>
  </div>

  <div class="mt-4 space-y-4">
    {% for d in days %}
  <div class="p-3 rounded border
     {% if d == today %}bg-yellow-100 ring-2 ring-yellow-400 border-yellow-400{% else %}bg-white/70{% endif %}">
    <div class="flex justify-between items-center">
      <div class="font-bold">{{ d|date:"l, m/d" }}</div>

      {% if can_edit %}
        <a class="text-xs underline"
           href="{% url 'calendar_event_create' %}?date={{ d|date:'Y-m-d' }}&return_to={{ request.get_full_path|urlencode }}{% if kiosk_qs %}&{{ kiosk_qs }}{% endif %}">
          Add
        </a>
      {% endif %}
    </div>

    {% with day_events=events_by_day|get_item:d %}

        {% if day_events %}
          <ul class="mt-2 space-y-1">
          {% for e in day_events %}
            <li>
              <div class="mt-1 text-xs p-1 rounded
                        {% if e.is_special %}
                            {% if e.color_key|lower == 'orange' %}bg-orange-200/90
                            {% elif e.color_key|lower == 'red' %}bg-red-200/90
                            {% elif e.color_key|lower == 'blue' %}bg-blue-200/90
                            {% elif e.color_key|lower == 'green' %}bg-green-200/90
                            {% elif e.color_key|lower == 'purple' %}bg-purple-200/90
                            {% elif e.color_key|lower == 'pink' %}bg-pink-200/90
                            {% else %}bg-gray-200/90{% endif %}
                        {% else %}
                            {% if e.person == 'mike' %}bg-blue-200/90
                            {% elif e.person == 'wife' %}bg-pink-200/90
                            {% elif e.person == 'kid1' %}bg-green-200/90
                            {% elif e.person == 'kid2' %}bg-purple-200/90
                            {% else %}bg-gray-200/90{% endif %}
                        {% endif %}
                      ">
                        
                        {% if e.all_day %}
                            <span class="font-semibold">All day</span> —
                            {% if e.id %}
                                <a class="underline"
                                href="{% url 'calendar_event_detail' e.id %}?return_to={{ request.get_full_path|urlencode }}{% if kiosk_qs %}&{{ kiosk_qs }}{% endif %}">
                                {{ e.title }}
                                </a>
                            {% else %}
                                {{ e.title }}
                            {% endif %}
                        {% else %}
                        <span class="font-semibold">{{ e.start_dt|date:"g:i A" }}</span>
                        - {{ e.end_dt|date:"g:i A" }} —
                        {% if e.id %}
                            <a class="underline"
                            href="{% url 'calendar_event_detail' e.id %}?return_to={{ request.get_full_path|urlencode }}{% if kiosk_qs %}&{{ kiosk_qs }}{% endif %}">
                            {{ e.title }}
                            </a>
                        {% else %}
                            {{ e.title }}
                        {% endif %}
                      {% endif %}
                     </div>
             </li>
          {% endfor %}
          </ul>
        {% else %}
          <div class="text-sm text-gray-600 mt-2">No events</div>
        {% endif %}
     
    {% endwith %}
    </div>
    {% endfor %}
  </div>
</div>


<script>

</script>

{% endblock %}