{% extends "base.html" %}
{% block content %}
<div class="max-w-6xl mx-auto px-2 py-6">
  <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-2 mb-4">
    <h1 class="text-2xl font-semibold">Applications</h1>

    <div class="flex gap-2">
      <a class="px-3 py-2 rounded-xl bg-white shadow hover:shadow-md transition text-sm"
        href="{% url 'jobtracker:dashboard' %}">
        Back
      </a>

      <a href="{% url 'jobtracker:application_create' %}"
        class="px-3 py-2 rounded-xl bg-emerald-600 text-white shadow hover:shadow-md transition text-sm">
        + Add Application
      </a>
      </div>
    
  </div>

  <form method="get" class="mb-4 flex flex-wrap gap-8 items-end justify-center">
    <div>
      <label class="block text-xs text-gray-600 mb-1">Search</label>
      <input type="text" name="q" value="{{ filters.q }}" class="px-3 py-2 rounded-xl bg-white shadow text-sm"
            placeholder="Company, job title, resume tag...">
    </div>

    <div>
      <label class="block text-xs text-gray-600 mb-1">Status</label>
      <select name="status" class="px-3 py-2 rounded-xl bg-white shadow text-sm">
        <option value="">All</option>
        {% for value,label in apps.model.Status.choices %}
          <option value="{{ value }}" {% if filters.status == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label class="block text-xs text-gray-600 mb-1">Company</label>
      <select name="company" class="px-3 py-2 rounded-xl bg-white shadow text-sm">
        <option value="">All</option>
        {% for c in companies %}
          <option value="{{ c.id }}" {% if filters.company|add:"" == c.id|add:"" %}selected{% endif %}>
            {{ c.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <label class="flex items-center gap-2 px-3 py-2 rounded-xl bg-white shadow text-sm">
      <input type="checkbox" name="due" value="1" {% if filters.due == "1" %}checked{% endif %}>
      Follow-ups due
    </label>

    <div class="flex gap-2">
      <button class="px-4 py-2 rounded-xl bg-emerald-600 text-white text-sm">Apply</button>
      <a href="{% url 'jobtracker:applications_list' %}" class="px-4 py-2 rounded-xl bg-gray-200 text-sm">Reset</a>
    </div>
  </form>

  <div class="bg-white rounded-2xl shadow overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-gray-50">
        <tr>
          <th class="text-left p-3">Company</th>
          <th class="text-left p-3">Title</th>
          <th class="text-left p-3">Status</th>
          <th class="text-left p-3">Applied</th>
          <th class="text-left p-3">Next Follow-up</th>
        </tr>
      </thead>
      <tbody class="divide-y">
        {% for a in apps %}
          <tr>
            <td class="p-3">{{ a.job.company.name }}</td>
            <td class="p-3">
            {% if a.id %}
                <a class="underline" href="{% url 'jobtracker:application_detail' a.id %}">
                  {{ a.job.title }}
                </a>
              {% else %}
                {{ a.job.title }}
              {% endif %}
            </td>
            <td class="p-3">{{ a.get_status_display }}</td>
            <td class="p-3">{{ a.applied_date }}</td>
            <td class="p-3">
                {% if a.next_followup_date %}
                    {{ a.next_followup_date }}
                {% else %}
                    <span class="text-gray-400">â€”</span>
                {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr><td class="p-3 text-gray-500" colspan="5">No applications yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}